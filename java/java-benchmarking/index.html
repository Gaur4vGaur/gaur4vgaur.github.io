<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.666 'Open Sans','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Open Sans','Georgia',serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Open Sans','Avenir Next','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Open Sans','Avenir Next','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Open Sans','Avenir Next','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Open Sans','Avenir Next','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Open Sans','Avenir Next','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Open Sans','Avenir Next','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}ul{margin-left:1.666rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.666rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;font-size:0.85rem;line-height:1.666rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;font-size:1rem;line-height:1.666rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}blockquote{margin-left:1.666rem;margin-right:1.666rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.666rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.666rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.666rem;margin-bottom:calc(1.666rem / 2);margin-top:calc(1.666rem / 2);}li > ul{margin-left:1.666rem;margin-bottom:calc(1.666rem / 2);margin-top:calc(1.666rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.666rem / 2);}code{font-size:0.85rem;line-height:1.666rem;}kbd{font-size:0.85rem;line-height:1.666rem;}samp{font-size:0.85rem;line-height:1.666rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.11067rem;padding-right:1.11067rem;padding-top:0.833rem;padding-bottom:calc(0.833rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><style data-href="/styles.715341be3a3a70ddd6a7.css" id="gatsby-global-css">.blog-container{display:flex}.blog-container section{border-left:1px solid #d3d3d3;flex:0 0 65%;padding:1% 2% 1% 5%}.post-summary{margin-bottom:2%}.post-summary p:first-child{color:#a0a0a0;font-size:75%;font-weight:lighter;margin-bottom:.2%}.post-summary span{padding:0 .2rem;border:1px solid #e6e6e6;border-radius:1.25rem}.post-summary .content p{color:#333;font-size:18px;font-weight:lighter;margin-bottom:1rem}.post-summary h2{margin-bottom:.5%}aside{flex:0 0 20%;padding:5% 5% 0;text-align:left}aside h3{font-size:120%;margin-bottom:1%;margin-top:10%}aside a{font-size:90%;margin-bottom:1%;margin-top:1%;color:#000}.post-pagination{display:flex;align-items:center;justify-content:space-around;max-width:300px;margin:auto}@media (max-width:991px){.blog-container{display:block}.blog-container section{border-right:none;padding-right:0}.post-summary:last-child{border-bottom:1px solid #d3d3d3;margin-bottom:0;padding-bottom:3em}aside{padding-top:3%;margin:auto;width:90%}}@media (max-width:640px){aside{padding:3em 0;width:100%}}@media (max-width:320px){.post-summary h2{font-size:22px}.post-summary p{font-size:16px}}button{background:#1d7eb5;border:none;border-radius:25px;color:#fff;font-size:10px;padding:.5em 1em}button:focus{outline:0}button:hover{background:orange}.app-container{margin-left:auto;margin-right:auto;padding:2em 2em 1em;position:relative}header{border-bottom:1px solid #d3d3d3;display:block;padding:1em 0;text-align:center;width:100%}h1{font-size:40px;margin:0}a,button{cursor:pointer}a:hover{color:orange;text-decoration:underline}main{min-height:100%}footer{font-size:14px;height:50px;margin-top:1em}.homeLinkContainer{max-width:30px;margin-left:auto;margin-right:auto}@media (max-width:991px){.app-container{padding:2em 5em}}@media (max-width:414px){.app-container{padding:2em 3em}}@media (max-width:320px){header{padding:.5em 0}h1{font-size:30px;margin-bottom:.3em}p{font-size:16px}}.posts{margin:auto;width:75%}.date{color:#1d7eb5;font-weight:700;margin-top:2rem}.posts ul:last-child{display:flex;justify-content:center}.posts a{color:#1d7eb5}.posts a:hover{color:orange}.posts .post-navigation{list-style-type:none;padding:0;margin:0}.posts .post-navigation-left{margin-right:auto}.posts .post-navigation-right{margin-left:auto}hr{background:0;margin-top:1em}.post-tag{display:inline-block;list-style-type:none;padding:0 .5rem;font-size:70%;border:2px solid #e6e6e6;border-radius:1.25rem}code.language-text{padding:2px 4px;font-size:90%;font-style:italic;color:#c7254e;background-color:#f9f2f4;border-radius:10%}iframe{width:70%;height:350px}.tag-heading{color:#a0a0a0;font-weight:700;margin-bottom:.2%;text-align:center}.tag-summary{text-align:center;font-size:80%}.tag-ul{padding-top:2rem;list-style-type:none}</style><meta name="generator" content="Gatsby 2.32.8"/><link rel="icon" href="/favicon-32x32.png?v=1822c4ede5e0519afd30ce9bcc8772df" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#a2466c"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=1822c4ede5e0519afd30ce9bcc8772df"/><title data-react-helmet="true">What is Microbenchmarking</title><meta data-react-helmet="true" name="description" content="An introduction to Microbenchmarking, when to use it and pitfalls to avoid."/><meta data-react-helmet="true" property="og:title" content="What is Microbenchmarking"/><meta data-react-helmet="true" property="og:description" content="An introduction to Microbenchmarking, when to use it and pitfalls to avoid."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Gaurav Gaur"/><meta data-react-helmet="true" name="twitter:title" content="What is Microbenchmarking"/><meta data-react-helmet="true" name="twitter:description" content="An introduction to Microbenchmarking, when to use it and pitfalls to avoid."/><meta data-react-helmet="true" name="twitter:image" content="https://gaurgaurav.com//java/java-benchmarking//twitter-card.jpg"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-162427596-1', 'auto', {});
      
      
      
      
      
      }</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'GTM-NSL5M7K');</script><link as="script" rel="preload" href="/webpack-runtime-84c69543f8be349fbf60.js"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/styles-55e82d6ff5158c00b714.js"/><link as="script" rel="preload" href="/app-0e2e15bdb5950635bdc7.js"/><link as="script" rel="preload" href="/37901854b18ac3f922034f7a5192515aca5d8e89-fa4cacbb77ee238004fb.js"/><link as="script" rel="preload" href="/9a73e11c226e0fd3885e8ee4fe4aa32fae90635c-9a052d03b0569e6aaba7.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-6134e44dfeb195104ce5.js"/><link as="fetch" rel="preload" href="/page-data/java/java-benchmarking/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/786959418.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/852313850.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NSL5M7K" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="app-container"><header><h1>What is Microbenchmarking</h1><p>Microbenchmarking with jvm is hard and when to use it.</p><div class="homeLinkContainer"><a href="/"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:100%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsUlEQVQ4y5WUQU9TQRCAtwUKBUQEUZRojBoKLV6l4M1wUA4GNeo/sC1tTagKrVzkoKgEEgwglJPISSRy6yNBC3LokQNpQm+0VNIbUG6UdnwzdTbvlR50k8mb3Zn9ZnZn3gooGLlcjgRHJpOR66jzOvtoffkrCmE8jo6O6BuLxUBRFNKPj4+lTzabJR/8FgVqIzEsGo1CQ/05EELA/Jf5v9AsgbWDoQQsTJuPGf4ZJpC11QaPHz0hfXR0TG5c+r4ED+4/hLXVNZm9BHIUjoTZIKDrdhdsb2/D3t4evHzRT2u+vufkM9Dvp/nU5JTuvoWWjuPd8Hty7HW5IZVKgb29Ay42NkEymYTx8Y9k83qeQXAmSPr0p2ld0YS2ko6nDnKamJik+7vUdJnmKDXVp2FjYwMWvy3SvPtONzgdTpgNzuoKJvju7qoO6BgKKVTVshITzU2l5SSoG4QRlpVlWP+1TvP2m3aIx+O6rhAHBwfQZrsB5vJK2NzchEk1O84KQUZRQsIBUOY+z9EJMMDVK9dg9/euzFJUV56CVouVInncHtpQYiiFUmMZgVBHYSjq6PP2zTAVrPH8BVqLRCL5DLF6+/v70HOvR2bFAIZpoRiIsx18NQiHh4fgH/DTVcgqJxIJGZ0z025mG6/znbZZ2040uATW1darTgZddnxneTHojo5rHfZOahcU2dgMrK05IzflYQY4W9cAluYWaL5ugSpztbQzEKvMIN2/rAXiMVFww8LXBXkc/0BA3vF/A/m44fCqBI6p//E/A3cSO3Q8hFWYzCTYYysrPyRw5MMIQSorqqhnUe+03yoOxB7UFyAvSkiRwKHXQyfs1hZb8fcwnU5DwB9Q/00XeN1etcG94HL2QmwrJoGYLdrxtfH1+VS7S30YZk688kL7ShcbaNc+oMXs2vEHyqEw6mBQRlUAAAAASUVORK5CYII=" alt="Link to go to home page" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/982f62b518e74b4945d6848ae164a14e/d286c/home.png 63w,
/static/982f62b518e74b4945d6848ae164a14e/905ea/home.png 125w,
/static/982f62b518e74b4945d6848ae164a14e/1b5b9/home.png 250w,
/static/982f62b518e74b4945d6848ae164a14e/c3078/home.png 375w,
/static/982f62b518e74b4945d6848ae164a14e/adf82/home.png 500w,
/static/982f62b518e74b4945d6848ae164a14e/6f213/home.png 1200w" sizes="(max-width: 250px) 100vw, 250px" /><img loading="lazy" sizes="(max-width: 250px) 100vw, 250px" srcset="/static/982f62b518e74b4945d6848ae164a14e/d286c/home.png 63w,
/static/982f62b518e74b4945d6848ae164a14e/905ea/home.png 125w,
/static/982f62b518e74b4945d6848ae164a14e/1b5b9/home.png 250w,
/static/982f62b518e74b4945d6848ae164a14e/c3078/home.png 375w,
/static/982f62b518e74b4945d6848ae164a14e/adf82/home.png 500w,
/static/982f62b518e74b4945d6848ae164a14e/6f213/home.png 1200w" src="/static/982f62b518e74b4945d6848ae164a14e/1b5b9/home.png" alt="Link to go to home page" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></a></div></header><main><section class="posts"><p class="date">April 05, 2021</p><div><h3>Introduction</h3>
<p>Optimisation of code is an endless struggle. It is often even hard to produce meaningful metrics using <code class="language-text">jvm</code> as it is an adaptive virtual machine. The article is</p>
<ul>
<li>a brief introduction to microbenchmarking,</li>
<li>why microbenchmark</li>
<li>when to consider it, and finally,</li>
<li>pitfalls to avoid</li>
</ul>
<h3>What is a microbenchmark</h3>
<p>A microbenchmark is an attempt to measure the performance of a small unit of code. The tests are usually in the sub-millisecond range. The test can help determine how the code is going to behave when put into production. It can act as a guide to a better implementation.</p>
<h3>Why microbenchmark</h3>
<p>Profiling the whole app in a production or production-like environment is difficult. Profiling cannot pinpoint a specific piece of code. Moreover, it also counts external factors such as logging. Yet, profiling does produce realistic results.
Micro-benchmarking focuses on a specific piece of code, removing everything else. But, you need to be careful of the results produced by benchmarking, as these are somewhat artificial.</p>
<p>If we are asking JVM to manage a small piece of code, it means that we are asking JVM to handle a different problem. JVM may optimize the code differently from that in production. GC may be much more effective for this small program, but it can take long pauses in actual production. Besides, the machine architecture of the production server could be completely different from the local machine used for benchmarking.</p>
<p>Why should I benchmark then?
Usually, it should be the job of <code class="language-text">jvm</code> to optimize the code. As a good practice, a developer should only focus on principles of clean coding. But it is always a good idea to review the code. You should consider asking can I break this loop early, or can I reduce the complexity of an algorithm?</p>
<h3>When to consider microbenchmark</h3>
<p>A developer should test an application in a way it is supposed to be used, with a similar kind of inputs. But, it might not be possible every time. For example, if you are trying to write an underlying support infrastructure for a variety of applications, or if you are producing a library. Thus, it is not possible to predict the range of inputs or to monitor and optimize the code for specific scenarios. In these scenarios, you can consider benchmarking.
Micro benchmarking may still not provide definitive answers to problems you may face, but, it can point towards a better design. </p>
<h3>Code to Microbenchmark</h3>
<p>Let us try to microbenchmark a piece of code. I am going to write a program to calculate nth Narcissistic number or a plus perfect number. If you have never heard about these numbers then you can refer to <a href="https://en.wikipedia.org/wiki/Narcissistic_number">Wikipedia</a>. These are the numbers where the number is equal to the sum of its own digits each raised to the power of the number of digits.</p>
<p>The first step is to define <code class="language-text">isNarNumber()</code> that would check if a provided number is a Narcissistic number.</p>
<pre class="grvsc-container monokai" data-language="java" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">public</span><span class="mtk1"> </span><span class="mtk7">class</span><span class="mtk1"> </span><span class="mtk5 mtku">NarcissisticNumber</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">public</span><span class="mtk1"> </span><span class="mtk7">static</span><span class="mtk1"> </span><span class="mtk9 mtki">boolean</span><span class="mtk1"> </span><span class="mtk5">isNarNumber</span><span class="mtk1">(</span><span class="mtk9 mtki">int</span><span class="mtk1"> </span><span class="mtk10 mtki">number</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">int</span><span class="mtk1"> length </span><span class="mtk7">=</span><span class="mtk1"> String.</span><span class="mtk5">valueOf</span><span class="mtk1">(number).</span><span class="mtk5">length</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">int</span><span class="mtk1"> sum </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">for</span><span class="mtk1"> (</span><span class="mtk9 mtki">int</span><span class="mtk1"> i </span><span class="mtk7">=</span><span class="mtk1"> number; i </span><span class="mtk7">&gt;</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">; i </span><span class="mtk7">=</span><span class="mtk1"> i </span><span class="mtk7">/</span><span class="mtk1"> </span><span class="mtk4">10</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            sum </span><span class="mtk7">+=</span><span class="mtk1"> </span><span class="mtk5">pow</span><span class="mtk1">(i </span><span class="mtk7">%</span><span class="mtk1"> </span><span class="mtk4">10</span><span class="mtk1">, length);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">return</span><span class="mtk1"> sum </span><span class="mtk7">==</span><span class="mtk1"> number;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Next step is to define the method <code class="language-text">findNarcissisticNumber()</code> to get the results</p>
<pre class="grvsc-container monokai" data-language="java" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">public</span><span class="mtk1"> </span><span class="mtk7">class</span><span class="mtk1"> </span><span class="mtk5 mtku">NarcissisticNumber</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">public</span><span class="mtk1"> </span><span class="mtk7">static</span><span class="mtk1"> </span><span class="mtk9 mtki">int</span><span class="mtk1"> </span><span class="mtk5">findNarcissisticNumber</span><span class="mtk1">(</span><span class="mtk9 mtki">int</span><span class="mtk1"> </span><span class="mtk10 mtki">n</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">int</span><span class="mtk1"> pointer </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">int</span><span class="mtk1"> i;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">for</span><span class="mtk1"> (i</span><span class="mtk7">=</span><span class="mtk4">1</span><span class="mtk1">; i</span><span class="mtk7">&lt;</span><span class="mtk1">Integer.MAX_VALUE </span><span class="mtk7">&amp;&amp;</span><span class="mtk1"> pointer </span><span class="mtk7">&lt;</span><span class="mtk1"> n; i</span><span class="mtk7">++</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk5">isNarNumber</span><span class="mtk1">(i)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                pointer </span><span class="mtk7">=</span><span class="mtk1"> pointer</span><span class="mtk7">+</span><span class="mtk4">1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">return</span><span class="mtk1"> i;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3>A Naive approach</h3>
<p>The concept of benchmarking seems straight. I can quickly measure the execution time of <code class="language-text">findNarcissisticNumber</code> by using <code class="language-text">System.currentTimeMillis()</code>. But, the approach might not be best suited with <code class="language-text">jvm</code>.</p>
<pre class="grvsc-container monokai" data-language="java" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">public</span><span class="mtk1"> </span><span class="mtk7">class</span><span class="mtk1"> </span><span class="mtk5 mtku">NarcissisticNumber</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">public</span><span class="mtk1"> </span><span class="mtk7">static</span><span class="mtk1"> </span><span class="mtk9 mtki">void</span><span class="mtk1"> </span><span class="mtk5">main</span><span class="mtk1">(</span><span class="mtk9 mtki">String</span><span class="mtk1">[] </span><span class="mtk10 mtki">args</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">int</span><span class="mtk1"> result;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">long</span><span class="mtk1"> before </span><span class="mtk7">=</span><span class="mtk1"> System.</span><span class="mtk5">currentTimeMillis</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">for</span><span class="mtk1"> (</span><span class="mtk9 mtki">int</span><span class="mtk1"> i </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">; i </span><span class="mtk7">&lt;</span><span class="mtk1"> cycles; i</span><span class="mtk7">++</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            result </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk5">findNarcissisticNumber</span><span class="mtk1">(</span><span class="mtk4">20</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">long</span><span class="mtk1"> after </span><span class="mtk7">=</span><span class="mtk1"> System.</span><span class="mtk5">currentTimeMillis</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        System.out.</span><span class="mtk5">println</span><span class="mtk1">(</span><span class="mtk6">"Time elapsed: "</span><span class="mtk1"> </span><span class="mtk7">+</span><span class="mtk1"> (after</span><span class="mtk7">-</span><span class="mtk1">before)</span><span class="mtk7">/</span><span class="mtk1">cycles </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">" seconds"</span><span class="mtk1"> );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3>Avoid Common Pitfalls</h3>
<p><code class="language-text">jvm</code>  is quite advanced, and it can optimize the code itself. The features of <code class="language-text">jvm</code> such as JIT compilation and garbage collection makes it hard to perform bencharmking. I am listing a few of the pitfalls, if are not considered, then may lead to inconsistent results.</p>
<h4>1. Skipping warm-up cycles</h4>
<p><code class="language-text">jvm</code> optimizes the code with each run. The code execution gets faster, the longer it is executed. Skipping <code class="language-text">jvm</code> warm-up will lead to inconsistent reading. Thus, benchmarking should include warm-up cycles to allow <code class="language-text">jvm</code> to optimize the code. </p>
<pre class="grvsc-container monokai" data-language="java" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">for</span><span class="mtk1"> (</span><span class="mtk9 mtki">int</span><span class="mtk1"> i </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">; i </span><span class="mtk7">&lt;</span><span class="mtk1"> warmupCycles; i</span><span class="mtk7">++</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    result </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk5">findNarcissisticNumber</span><span class="mtk1">(</span><span class="mtk4">20</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">for</span><span class="mtk1"> (</span><span class="mtk9 mtki">int</span><span class="mtk1"> i </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">0</span><span class="mtk1">; i </span><span class="mtk7">&lt;</span><span class="mtk1"> cycles; i</span><span class="mtk7">++</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    result </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk5">findNarcissisticNumber</span><span class="mtk1">(</span><span class="mtk4">20</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h4>2. Dead Code</h4>
<p>Even after considering the warm-up cycles, it is possible that execution time is reported as 0. Since <code class="language-text">result</code> is not used anywhere <code class="language-text">jvm</code> can skip the loop altogether. It is also possible that the compiler performs partial iterations, thus, leading to even more inconsistent result.  To fix the issue it is better to read it is advisable to read the result.</p>
<h4>3. Not testing a range of input</h4>
<p>Even if the code starts using the <code class="language-text">result</code> variable, we may still get irregular readings. The code above always calculates the 20th Narcissistic number. A smart compiler can figure that out and can replace the method call with the result. The iterations are redundant, and the compiler can skip a few of those.</p>
<p>Moreover, the code in production would calculate the Narcissistic number on a range of inputs. Hence, we should also benchmark the code with a similar range of inputs.</p>
<h4>4. Noisy neighbours</h4>
<p>While running benchmarking on the machine, you might not be aware of all the processes running your system. It is possible to have background apps contending for CPU and RAM on the local machine. Thus, creating a server like environment is difficult.  Mitigating the noisy neighbour problem is a bit tricky.</p>
<h3>Conclusion</h3>
<p>It is difficult to achieve good benchmarking stats. We need to consider all the factors if we want to achieve reliable results. The article highlights the pitfalls of benchmarking. In the next post, we will explore Java Microbenchmark Harness (jmh). JMH is a powerful tool and can help us to benchmark the code.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .monokai {
    background-color: #272822;
    color: #f8f8f2;
  }
  .monokai .mtki { font-style: italic; }
  .monokai .mtku {
    text-decoration: underline;
    text-underline-position: under;
  }
  .monokai .mtk7 { color: #F92672; }
  .monokai .mtk1 { color: #F8F8F2; }
  .monokai .mtk5 { color: #A6E22E; }
  .monokai .mtk9 { color: #66D9EF; }
  .monokai .mtk10 { color: #FD971F; }
  .monokai .mtk4 { color: #AE81FF; }
  .monokai .mtk6 { color: #E6DB74; }
  .monokai .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div><ul class="post-navigation"><li class="post-tag"><a href="/tags/java/">Java</a></li><li class="post-tag"><a href="/tags/jvm/">jvm</a></li><li class="post-tag"><a href="/tags/java-microbenchmark-harness/">Java Microbenchmark Harness</a></li><li class="post-tag"><a href="/tags/microbenchark/">Microbenchark</a></li><li class="post-tag"><a href="/tags/2021/">2021</a></li></ul><ul class="post-navigation"><li class="post-navigation-left"></li><li class="post-navigation"><a rel="next" href="/scala/sorting-lists-of-objects/">Sorting Lists of Objects in Scala<!-- --> →</a></li></ul></section></main><footer>© <!-- -->2021<!-- -->, Gaurav Gaur</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/java/java-benchmarking/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2966d4d8fea208fd6f8f.js"],"app":["/app-0e2e15bdb5950635bdc7.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-0f40d706ebc58d78c1f6.js"],"component---src-pages-404-js":["/component---src-pages-404-js-df87e95aa556b0f284b8.js"],"component---src-templates-index-js":["/component---src-templates-index-js-304caf2707deeca50504.js"],"component---src-templates-post-js":["/component---src-templates-post-js-6134e44dfeb195104ce5.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-4e1c6b02dba4e27d6d09.js"]};/*]]>*/</script><script src="/polyfill-2966d4d8fea208fd6f8f.js" nomodule=""></script><script src="/component---src-templates-post-js-6134e44dfeb195104ce5.js" async=""></script><script src="/9a73e11c226e0fd3885e8ee4fe4aa32fae90635c-9a052d03b0569e6aaba7.js" async=""></script><script src="/37901854b18ac3f922034f7a5192515aca5d8e89-fa4cacbb77ee238004fb.js" async=""></script><script src="/app-0e2e15bdb5950635bdc7.js" async=""></script><script src="/styles-55e82d6ff5158c00b714.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script><script src="/webpack-runtime-84c69543f8be349fbf60.js" async=""></script></body></html>